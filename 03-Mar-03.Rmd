## TIL20220321

### ê°€ì„¤ê²€ì •

#### ë²”ì£¼í˜• ë°ì´í„°

##### í•œ ì§‘ë‹¨ì¼ ë•Œ

**ì¼ì› ì¹´ì´ ì œê³± ê²€ì •**

:   one sample $x^2$ test, ì í•©ì„± ê²€ì •ì—í™œìš©

```{r}
# ì£¼ì‚¬ìœ„ë¥¼ 60ë²ˆ ë˜ì ¸ ë•Œ, ê¸°ëŒ€ë¹ˆë„ì™€ ê´€ì¸¡ë¹ˆë„ê°€ ì í•©í•œì§€ ê²€ì •
# ê·€ë¬´ê°€ì„¤: ê¸°ëŒ€ë¹ˆë„ì™€ ê´€ì¸¡ë¹ˆë„ëŠ” ì°¨ì´ê°€ ì—†ë‹¤
# ëŒ€ë¦½ê°€ì„¤: ê¸°ëŒ€ë¹ˆë„ì™€ ê´€ì¸¡ë¹ˆë„ëŠ” ì°¨ì´ê°€ ìˆë‹¤.

chisq.test(c(4,6,17,15,9,9), p = rep(1/6, 6))
```

pê°’ì— ë”°ë¼ ìœ ì˜ìˆ˜ì¤€ 0.05ì—ì„œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•˜ê³  ëŒ€ë¦½ê°€ì„¤ì„ ì±„íƒí•œë‹¤. ì¦‰ ì£¼ì‚¬ìœ„ì˜ ê¸°ëŒ€ë¹ˆë„ì™€ ê´€ì¸¡ë¹ˆë„ì—ëŠ” ì°¨ì´ê°€ ìˆë‹¤ê³  íŒë‹¨í•  ìˆ˜ ìˆë‹¤.

```{r}
# í†µì‹  3ì‚¬ ì ìœ ìœ¨ ì°¨ì´ 40%, 30%, 30%ì¸ì§€ ê²€ì •
chisq.test(c(45, 30, 25), p = c(0.4, 0.3, 0.3))
```

##### ë‘ ì§‘ë‹¨ì¼ ë•Œ

**ì´ì› ì¹´ì´ ì œê³± ê²€ì •**

```{r}
if(!require(palmerpenguins)) { install.packages("palmerpenguins"); library(palmerpenguins); }
chisq.test(x=penguins$species, y=penguins$island)
```

```{r}
if(!require(gmodels)) { install.packages("gmodels"); library(gmodels); }

CrossTable(x=penguins$species, y=penguins$island, chisq = T)
```

##### í”¼ì…” ì •í™• ê²€ì •

ë¶„í• í‘œë¥¼ ê·¸ë¦° ë’¤ ì¹´ì´ ì œê³±ì„ ì ìš©í•  ë•Œ í‘œë³¸ ìˆ˜ê°€ ì ê±°ë‚˜ í‘œë³¸ì´ ë¶„íŒ”í‘œì˜ ì…€ì— ë§¤ìš° ì¹˜ìš°ì¹˜ê²Œ ë¶„í¬ë˜ì–´ ìˆë‹¤ë©´ ì¹´ì´ ì œê³± ê²€ì •ì˜ ê²°ê³¼ê°€ ë¶€ì •í™•í•  ìˆ˜ ìˆë‹¤. ê¸°ëŒ€ ë¹ˆë„ê°€ 5 ì´í•˜ì¸ ì…€ì´ ì „ì²´ì˜ 20% ìˆ˜ì¤€ì¼ ë•Œ í‘œë³¸ì˜ ìˆ˜ê°€ ì ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤. ì´ëŸ° ê²½ìš° Fisher's Exact Testë¥¼ ì ìš©í•œë‹¤.

```{r}
if(!require(MASS)) { install.packages("MASS"); library(MASS); }

xtabs( ~ W.Hnd + Clap, data = survey)
```

```{r}
chisq.test(survey$W.Hnd, survey$Clap)
```

```{r}
fisher.test(survey$W.Hnd, survey$Clap)
```

##### ë§¥ë‹ˆë§ˆ ê²€ì • (McNemar Test)

ì‚¬ê±´ ì „í›„ì˜ ì°¨ì´ ê²€ì •ì— í™œìš©ëœë‹¤.

```{r}
Performance <-
   matrix(c(794, 86, 150, 570),
          nrow = 2,
          dimnames = list(
          "1st Survey" = c("Approve", "Disapprove"),
          "2nd Survey" = c("Approve", "Disapprove")))
Performance
```

```{r}
mcnemar.test(Performance)
```

pê°’ì— ë”°ë¼ ì²«ë²ˆì§¸ ì¡°ì‚¬ì™€ ë‘ë²ˆì§¸ ì¡°ì‚¬ ê°„ì—ëŠ” ìœ ì˜í™•ë¥  0.05 í•˜ì—ì„œ í†µê³„ì ìœ¼ë¡œ ìœ ì˜ë¯¸í•œ ì°¨ì´ê°€ ìˆë‹¤.

ì°¸ê³ ë¡œ, ì‚¬ê±´ ì „í›„ì˜ ì°¨ì´ ê²€ì •ì€ b=cë¥¼ ê²€í† í•˜ì—¬ ë³€í™” ì—¬ë¶€ë¥¼ íŒë‹¨í•  ìˆ˜ ìˆë‹¤. $$b \sim B(b+c, \frac{1}{2})$$

ë”°ë¼ì„œ ìœ„ ì˜ˆì œì˜ ê²½ìš° 86 \~ B(86+150, 1/2)ë¥¼ ê²€í† í•œë‹¤.

```{r}
binom.test(86, 86+150, 0.5)
```

#### ì—°ì†í˜• ë°ì´í„°

##### ì •ê·œì„± ê²€ì •

###### shapiro.test()

```{r}
shapiro.test(rnorm(1000))
```

###### ks.test()

ì½œëª¨ê³ ë¡œí”„ ìŠ¤ë¯¸ë¥´ë…¸í”„ ê²€ì •(Kolmogorov-Smirnov Test), ë‘ ìˆ«ì ë²¡í„° ê°„ì˜ ì°¨ì´ê°€ ì—†ëŠ”ì§€ë¥¼ ê²€ì •í•œë‹¤.

```{r}
ks.test(rnorm(100), rnorm(100))
```

```{r}
ks.test(rnorm(100), runif(100))
```

xë¥¼ ì •ê·œë¶„í¬ì—ì„œ ì¶”ì¶œí•˜ì˜€ëŠ”ì§€ ê²€ì •ì„ í•  ìˆ˜ë„ ìˆë‹¤.

```{r}
ks.test(rnorm(1000), "pnorm", 0 ,1)
```

```{r}
ks.test(runif(1000), "pnorm", c(0, 1))
```

###### qqplot()

```{r}
x <- rnorm(1000, mean = 10, sd = 1)
qqnorm(x); qqline(x, lty=2, col = "blue")
```

```{r}
x <- runif(1000)
qqnorm(x); qqline(x, lty=2, col = "red")
```

```{r}
qqplot(runif(1000, min=1, max=10), 1:10)
```

```{r}
qqplot(rnorm(1000), 1:1000)
```

##### í•œ ì§‘ë‹¨ì¼ ë•Œ

###### one sample t-test

####### ì •ê·œì„±ì„ ë§Œì¡±í•  ê²½ìš° t.test()

####### ì •ê·œì„±ì„ ë§Œì¡±í•˜ì§€ ëª»í•  ê²½ìš° wilcox.test(), Wilcoxon signed rank test

##### ë‘ ì§‘ë‹¨ì¼ ë•Œ

###### independent two sample t-test

####### ì •ê·œì„±ì„ ë§Œì¡±í•  ê²½ìš° t.test()

####### ì •ê·œì„±ì„ ë§Œì¡±í•˜ì§€ ëª»í•  ê²½ìš° wilcox.test(), Wilcoxon rank sum test

###### paired two sample t-test

####### ì •ê·œì„±ì„ ë§Œì¡±í•  ê²½ìš° t.test()

####### ì •ê·œì„±ì„ ë§Œì¡±í•˜ì§€ ëª»í•  ê²½ìš° wilcox.test(), Wilcoxon signed rank test with paired

##### ì„¸ ì§‘ë‹¨ ì´ìƒì¼ ë•Œ

####### ì •ê·œì„±ì„ ë§Œì¡±í•  ê²½ìš° aov()

####### ì •ê·œì„±ì„ ë§Œì¡±í•˜ì§€ ëª»í•  ê²½ìš° kruskal()

####### ì‚¬í›„ê²€ì •

Fisher's LSD, Bonferroni, Shelf, Turkey, Duncan ë“±

### ë¹„ìœ¨ê²€ì •

#### ì¼í‘œë³¸ binom.test()

#### ì´í‘œë³¸ prop.test()

### ë™ì§ˆì„± ê²€ì‚¬

#### ì´í‘œë³¸ var.test()

#### ì‚¼í‘œë³¸ ì´ìƒ bartlett.test()

## TIL20220322

### ë¹„ëª¨ìˆ˜ ê²€ì •

```{r}
if(!require(moonBook)) { install.packages("moonBook"); library(moonBook); }
if(!require(palmerpenguins)) { install.packages("palmerpenguins"); library(palmerpenguins); }
data <- penguins
densityplot(body_mass_g ~ sex, data = data)
```

0.  ì •ê·œì„± ê²€ì •

```{r}
shapiro.test(data$body_mass_g)
```

1.  Wilcoxon Rank Sum Test

```{r}
wilcox.result <- wilcox.test(body_mass_g ~ sex, data); wilcox.result
```

2.  Kruskal-Wallis Rank Sun Test

```{r}
kruskal.result <- kruskal.test(body_mass_g ~ species, data); kruskal.result
```

3.  ë‹¤ì¤‘ë¹„êµ mctp in nparcomp package

```{r}
if(!require(nparcomp)) { install.packages("nparcomp"); library(nparcomp); }
mctp(body_mass_g ~ species, data)
```

### ANOVA in R

#### ANOVA ê°€ì • ì ê²€

```{r}
if(!require(dplyr)) { install.packages("dplyr"); library(dplyr); }
if(!require(palmerpenguins)) { install.packages("palmerpenguins"); library(palmerpenguins); }
if(!require(ggplot2)) { install.packages("ggplot2"); library(ggplot2); }

data <- penguins %>% select(body_mass_g, species, sex) %>% na.omit()

ggplot(data, aes(species, body_mass_g, col=sex)) +
  geom_boxplot() +
  theme_bw()
```

í­ê·„ ì¢…ì— ë”°ë¥¸ ëª¸ë¬´ê²Œì˜ ìœ ì˜í•œ ì°¨ì´ê°€ ìˆëŠ”ì§€ ANOVAë¡œ ë¶„ì„í•œë‹¤. ì‹ ë¢°ì„± ìˆëŠ” ê²°ê³¼ ë„ì¶œì„ ìœ„í•´ ì•„ë˜ì˜ ê°€ì •ì„ í™•ì¸í•œë‹¤.

-   ë³€ìˆ˜ ìœ í˜• ë…ë¦½ë³€ìˆ˜ ë²”ì£¼í˜•, ì¢…ì†ë³€ìˆ˜ ì—°ì†í˜•

```{r}
str(data)
```

-   ë…ë¦½ì„±, *durbinWatsonTest()* í•¨ìˆ˜ë¥¼ í†µí•´ í†µê³„ì ìœ¼ë¡œ ê²€ì •

```{r}
if(!require(car)) { install.packages("car"); library(car); }

data.aov <- aov(body_mass_g ~ species, data)
durbinWatsonTest(data.aov)
```

-   ì •ê·œì„±

    -   Shapiro-Wilk normality test
    -   Kolmogorov-Smirnov test
    -   QQPlot, Histogram

    ```{r}
    # Shapiro-Wilk normality test
    shapiro.test(data.aov$residuals)
    ```

```{r}
# Kolmogorov-Smirnov test
ks.test(x = data$species, y = data$body_mass_g)
```

```{r}
# QQPlot, Histogram
qqPlot(data.aov)
```

-   ë“±ë¶„ì‚°ì„±
    -   Levene's test
    -   Bartlette test
    -   Boxplot

```{r}
leveneTest(body_mass_g ~ species, data)
```

```{r}
leveneTest(body_mass_g ~ species*sex, data)
```

```{r}
bartlett.test(body_mass_g ~ species, data)
```

```{r}
bartlett.test(body_mass_g ~ interaction(species,sex), data)
```

-   ì´ìƒì¹˜
    -   Boxplot, outlierTest()

```{r}
outlierTest(data.aov)
```

```{r}
range(data$body_mass_g); data[164,]
```

#### ANOVA

-   oneway.test(..., var.equal=)

```{r}
oneway.result <- oneway.test(body_mass_g ~ species, data, var.equal = F); oneway.result
```

-   aov()

```{r}
aov.result <- aov(body_mass_g ~ species, data)
summary(aov.result)
```

-   Kruskal-Wallis test (ì •ê·œì„± ë¶ˆë§Œì¡± ì‹œ)

```{r}
kruskal.test(body_mass_g ~ species, data)
```

#### ì‚¬í›„ê²€ì •

-   Tukey HSD

```{r}
TukeyHSD(aov.result)
```

```{r}
if(!require(multcomp)) { install.packages("multcomp"); library(multcomp); }
tukey.result <- glht(aov.result, 
                       linfct = mcp(species = "Tukey")); tukey.result
```

```{r}
plot(tukey.result, las=1)
```

-   Dunnett

```{r}
if(!require(multcomp)) { install.packages("multcomp"); library(multcomp); }
dunnett.result <- glht(aov.result, 
                       linfct = mcp(species = "Dunnett")); dunnett.result
```

-   Bonferroni correction

```{r}
pairwise.t.test(data$body_mass_g, data$species, p.adjust.method = "bonferroni")
```

## TIL20220323

### íˆíŠ¸ë§µ in R

```{r}
if(!require(palmerpenguins)) { install.packages("palmerpenguins"); library(palmerpenguins); }
data <- penguins

data.matrix <- as.matrix(cor(data[,3:6], use="complete.obs"))
```

#### heatmap() in base

```{r}
if(!require(reshape2)) { install.packages("reshape2"); library(reshape2); }

heatmap(data.matrix, Rowv = NA, Colv = NA)

```

#### heatmap.2() in gplots

```{r}
if(!require(gplots)) { install.packages("gplots"); library(gplots); }
heatmap.2(data.matrix, Rowv = NA, Colv = NA, )
```

#### geom_tile() in ggplot2

```{r}
if(!require(reshape2)) { install.packages("reshape2"); library(reshape2); }
if(!require(ggplot2)) { install.packages("ggplot2"); library(ggplot2); }


data.melted <- melt(data.matrix); head(data.melted)

ggplot(data.melted, aes(x=Var1, y=Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low="red", mid = "white", high="blue") +
  guides(fill = guide_colorbar(barwidth = .5, barheight = 15))
```

## TIL20220324

### ê¸°ê³„í•™ìŠµ ëª¨ë¸ë§ with Caret

1.  ë°ì´í„° ì¤€ë¹„
2.  ë°ì´í„° íƒìƒ‰
3.  ë°ì´í„° ì „ì²˜ë¦¬
4.  ë°ì´í„° ë¶„í• 
5.  ëª¨ë¸ í•™ìŠµ
6.  ì˜ˆì¸¡ ë° ì„±ëŠ¥í‰ê°€
7.  ëª¨ë¸ ê°œì„ 

```{r}
# ë°ì´í„° ì¤€ë¹„
if(!require(dplyr)) { install.packages("dplyr"); library(dplyr); }
if(!require(caret)) { install.packages("caret"); library(caret); }
if(!require(ggplot2)) { install.packages("ggplot2"); library(ggplot2); }
if(!require(mlbench)) { install.packages("mlbench"); library(mlbench); }
data <- BreastCancer
```


```{r}
# ë°ì´í„° íƒìƒ‰
str(data)
```


```{r}
summary(data)
```

```{r}
colSums(is.na(data))
```

```{r}
table(data$Class)
```


```{r}
# ë°ì´í„° ì „ì²˜ë¦¬
if(!require(dplyr)) { install.packages("dplyr"); library(dplyr); }

data <- data %>% select(-Id) # í•„ìš”í•œ ì»¬ëŸ¼ ì œì™¸
data <- data %>% na.omit() # ê²°ì¸¡ì¹˜ ì œì™¸ (16/699ì´ë¯€ë¡œ)
```


```{r}
# ë°ì´í„° ë¶„í• 
if(!require(caret)) { install.packages("caret"); library(caret); }

train.index <- createDataPartition(data$Class, p=.7, list=F)
data.train <- data[train.index, ]
data.test <- data[-train.index, ]
```


```{r}
# ëª¨ë¸ í•™ìŠµ
trCtrl.up <- trainControl(sampling = "up")
trCtrl.down <- trainControl(sampling = "down")

model.dt.up <- train(Class ~ ., data = data.train, method = "rpart", trControl = trCtrl.up)
model.dt.down <- train(Class ~ ., data = data.train, method = "rpart", trControl = trCtrl.down)

model.list <- list(up = model.dt.up, down = model.dt.down)
model.resamples <- resamples(model.list)
dotplot(model.resamples)
```


```{r}
# ì˜ˆì¸¡ ë° ì„±ëŠ¥í‰ê°€
model.dt.up.pred <- predict(model.dt.up, data.test)
model.dt.down.pred <- predict(model.dt.down, data.test)
rbind(up = mean(model.dt.up.pred == data.test$Class),
      down = mean(model.dt.down.pred == data.test$Class) )
```

```{r}
if(!require(pROC)) { install.packages("pROC"); library(pROC); }
model.dt.up.pred <- predict(model.dt.up, data.test, type = "prob")
model.dt.down.pred <- predict(model.dt.down, data.test, type = "prob")
roc(data.test$Class, model.dt.up.pred[,1], plot=T, print.auc=T, col="red")
roc(data.test$Class, model.dt.down.pred[,1], plot=T, print.auc=T, add=T, col="blue", print.auc.adj=c(0,-1))
text(1.2, 0.8, "Blue: Down sampling\nRed: Up sampling")
```
### ë‹¤ì¤‘ë²”ì£¼ ROC

```{r}
if(!require(rpart)) { install.packages("rpart"); library(rpart); }
data <- penguins
data <- na.omit(data)
set.seed(1234)
train.index <- sample(nrow(data), 0.7*nrow(data), replace=F) 
train <- data[train.index,]
test <- data[-train.index,]
model.dt <- rpart(species ~ ., train)
model.dt.pred <- predict(model.dt, test, type="class")

if(!require(pROC)) { install.packages("pROC"); library(pROC); }
mroc <- multiclass.roc(test$species, as.numeric(model.dt.pred))
pROC::plot.roc(mroc$rocs[[1]], plot=T, col=1, print.auc=T)
for(i in 2:3) {
  pROC::plot.roc(mroc$rocs[[i]], plot=T, col=i, print.auc=T, add=T,
                 print.auc.adj = c(0,i))
}
```

## TIL20220325

ì•„... ì´ë‚ ì€ ìŠì§€ ë§ì ğŸ¤®

## TIL20220326

[Github] ê¹ƒí—ˆë¸Œ ì»¤ë°‹ ë‚ ì§œë¥¼ ì¡°ì‘í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ì‹ ê°€ìš”? ^[https://cindycho.tistory.com/71]  

ì´ê²Œ ë˜ëŠ”êµ¬ë‚˜...

## TIL20220327




